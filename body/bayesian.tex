\graphicspath{{../body/bayesian_figures/}}
\chapter{基于Bayesian博弈模型的资源分配算法}
\label{chap_bayesian_game}
在博弈论中有这样一种博弈：一些参与者可能不知道其他参与者的收益。
我们将这种类型的博弈称之为不完全信息的博弈。
在很多情况下，对完美知识的假设是一个简单而又恰当的近似。
类似的，在网络资源分配中，因为实际用户业务种类繁多，所以
想要在资源分配之前，准确获取用户对资源的精确要求比较困难。
同时，如果用户是基于分布式博弈决策模型，那么每个用户除了对自身的资源需求清楚之外，对其他用户的信息也知之甚少。
本章提出了一个基于Bayesian博弈的资源分配模型。
这个模型可以有效地描述在不完备信息下的用户竞争资源的情况。
通过建立适当的收益与惩罚函数，激励用户自身去根据自已的情况做出理性的分析，避免过多的占用系统资源。
%
\section{引言}
由于无线资源的稀缺，研究者在对无线资源分配及管理方面做了许多意义的工作。
近年来，博弈论做为经济学家常用的数学方法也被引入到无线网络方面，特别是针对Ad Hoc网络或无线传感器网络\cite{Srivastava:2005}\cite{FangBensaou2004}。
博弈论的本质是通过数学来研究多个有利益冲突的理性个体如何调整自己行为。
通常的构造合适博弈论模型及其博弈规则，可以引导自私但又理性的个体做出既有利于自已又利于其他参与者的决策。
例如，在无线资源分配中，用户往往为了保证自身最佳的服务质量，会过多占用系统的资源，导致整个系统性能的下降。为此，学者Zhang和Liu针对这个问题，提出竞价博弈及税制机制来限制用户这种过分贪婪的行为\cite{ZhangLiu2011}。

但是这些方法都会有一个比较严格的假设：对于所有用户而言，每个用户都要拥有其他用户的完备信息，并且会设置一个集中控制的单元负责传递用户之间的各种消息。例如，在文献\cite{ZhangLiu2011}中，用户的各种私有信息，收益函数的参数等等都要在用户之间进行交换。

这类分析模型称之为完全信息下博弈模型。
在本章中我们提出另外一种新的分析模型：Bayesian模型。
这种分析模型与上面的完全信息博弈模型不同。
每个用户除了对自身的收益一清二楚外，对模型中的其他用户的信息是不完整的。也就是说用户的私有信息是被保护的。
\section{资源分配模型}
假设在一个无线网络的基站覆盖范围内，目前有~$N$~个在线用户正在共享着无线资源。
为了能够更加公平且有效的使用这些资源，基站控制器在有新的用户进入的时候，启动一次资源调整的方案，重新分配目前的全部资源。
例如，在IEEE802.16标准中，基站控制器可以通过引导各个用户投票来竞争所需要的资源。由于资源有限，随着用户的数目逐渐增多，竞争就会加剧。有时，会出现先接受服务的用户为了保证自身的服务质量尽可能的好，长期大量的占用着大量的资源不加以释放。如果对这种贪婪用户的情况不能有效地加以处理，整个资源的利用率可能会恶化。
为了能够从机制上规范这些用户的行为，并改变其自身的资源占用策略。我们希望通过Bayesian博弈的方式来让这些用户能够根据自身真实的需求来进行理性的资源申请和使用。
在我们的博弈模型中，有~$N$~个博弈的参与者（Players）。
每个参与者都要在这个博弈过程中做出这样的决策：是否减少一部分自己已经占用的资源。这部分的资源我们会把它们重新放到资源池中，供新的用户使用。
这种出让部分自身已经占用资源的行为，我们将它称之为“贡献”。
当然，用户根据自身情况也可选择“拒绝”。<F5>
这种决策形式是典型的~$0-1$~决策。
在决策之前，每个用户都要理性且独立地评估自己的“贡献成本”，~$c$~。
为了鼓励这种贡献行为，中心控制单元设置了奖惩的机制。如果他成为一个贡献者，我们提供奖励收益，~$b$~。
如果用户选择不贡献，那么用户的奖励收益~$b$~为~$0$~。
同时，对选择不贡献的用户设置了有条件的惩罚系数~$\tau$~：
如果至少有一个其它的用户决定贡献，那么这个选择不贡献的用户才会被惩罚。
也就是说，当在线的所有用户都决策不贡献，那么意味着当前网络资源利用率已经达到了饱和的上限。因此，所有的不贡献用户都不会受到惩罚。

假设用户的奖励收益是公共知识，是所有用户提前就被广播通知的。
而每个用户自身的贡献成本是私有的知识。
我们假设因为用户种类不同，用户贡献成本也代表着用户业务的类型特征。
我们假设这个值是一个随机的变量，且只有用户自己知道具体的数值。
这里需要注意是，用户虽然不知道其他用户成本随机变量的具体数值，但是知道这个随机变量的分布函数。
这里，我们假设所有用户成本随机变量是独立同分布的，并且其累积概率分布函数~$P(\cdot)$~在区间~$[C_{\min}, C_{\max}]$~是连续增函数，
%其中~$0 \leq C_{\min} < C_{\max}$~，且我们设 ~$P(C_{\min})=0$~，~$P(C_{\max})=1$~。

对于一个用户而言，它的策略选择可用函数~$s_i(c_i)$~来描述。
此函数的定义域是区间~$[C_{\min}, C_{\max}]$~，值域是集合~$\{0,1\}$~中取任意一个值。
~$1$~表示用户愿意“贡献”；~$0$~表示用户“拒绝贡献”。
~$i$~表示用户的序号。

因此，对于用户~$i$~来说，他的收益函数可以定义为
\begin{equation}
 u_i(s_i, s_{-i}, c_i, b, \tau) = s_i(b - c_i) - \max\{s_{-i}\} \tau
\label{eqn_player_payoff}     
\end{equation}
其中，记号~$-i$~表示除参与者~$i$~之外的其它所有参与者的集合。
记号~$s_{-i}$~表示参与者集合~$-i$~的策略选择。
%
\section{Baye sian博弈分析}
对于所有用户的选择来说，一个Bayesian均衡可以用一个策略向量~$( s_1^*(c_1^*), s_2^*(c_2^*), \ldots, s_N^*(c_N^*) )$~来描述。
对于每一个理性且自私的用户，他总想通过自己的选择来使自己的收益最大化，~$\max(u_i)$~。
如果我们使用混合策略，那么问题会转化为最大化用户的期望收益，~$\max{E(u_i)}$~。
这里我们定义一个均衡概率的概念，~$\theta_{-i}$~。
它表示对于用户~$i$~而言，至少有一个其他的用户的决定是贡献的概率。
这个概率的具体形式是
\begin{equation}
    \theta_{-i} = \hbox{Prob} \Bigl\{ \max\{ s_{-i}^*\} = 1 \Bigr\} 
    \label{eqn_at_least_one_probability} 
\end{equation}
对于一个给定的用户~$i$~，他的期望收益可以定义为如下公式：
\begin{align}
     E(u_i) &= \theta_{-i} [s_i(b-c_i) -\tau] + (1-\theta_{-i}) (s_i(b-c_i) - 0) \notag\\ 
     &= s_i(b-c_i) - \theta_{-i}\tau
    \label{eqn:player_expe_payoff}
\end{align}
从公式\ref{eqn:player_expe_payoff}可以看出，
如果用户~$i$~的成本~$c_i$~小于~$b-\theta_{-i}\tau$~，那么用户~$i$~的决策就是贡献，也就是~$s_{i}^*=1$~。
如果~$c_i > b - \theta_{-i} \tau$~，那么用户就不愿意贡献，而会选择拒绝，~$s_i^*(c_i) = 0$~。
那么我们可以将其写为一个分段函数的形式。
\begin{align}
    s_i^*(c_i) = \begin{cases} 1, &\text{if $c_i < b -\theta_{-i}\tau$;}\\
        0, &\text{if $c_i > b -\theta_{-i}\tau$.}\\ \end{cases} 
    \label{eqn_equilibrium_strategy} 
\end{align}
从公式\ref{eqn_equilibrium_strategy}可以看出，用户$i$的成本对决策的影响很关键。
如果他的成本$c_i$在区间$ [C_{\min}, c_i^*] $，用户的决策就是同意贡献。
所以，我们又可求得用户$i$贡献的均衡概率$P(c_i^*)$。
\begin{align}
    P(c_i^*) = \hbox{Prob} \Bigl\{ C_{\min} < c_i \leq c_i^* \Bigr\} 
    \label{eqn:equil_prob_c_i}
\end{align}
而且，
如果存在这样一个均衡，那么它的概率可以计算出来。
\begin{align*} 
    \theta_{-i} &= \hbox{Prob} \Bigl\{ \max\{ s_{-i}^*\} = 1 \Bigr\} \\ 
    &= 1- (1-P(c_1^*))(1-P(c_2^*))\cdots(1-P(c_{i-1}^*)) (1-P(c_{i+1}^*)) \cdots(1-P(c_N^*)) \\ 
    &= 1- \prod_{j\in\{-i\}} [1-P(c_j^*)] 
\end{align*}
同时，从公式\ref{eqn_at_least_one_probability}和公式\ref{eqn_equilibrium_strategy}可知，
成本 $c_i$是关键，并且要满足公式\ref{eqn_equilibrium_cost}
\begin{align}
    c_i^* &= b - \theta_{-i} \tau \notag\\
    &= b - \tau + \Bigl[ \prod_{j \in\{-i\} } [1 - P(c_j^*) ] \Bigr] \tau
    \label{eqn_equilibrium_cost} 
\end{align}
又因为，对于任意一个$c_i, i=1,\ldots, N$，都要满足公式\ref{eqn_equilibrium_cost}。
所以，$c_i, i=1,\ldots, N$之间是可以互换的，也就是说如果存在一个唯一的$c^*$，且满足\ref{eqn_equilibrium_cost}，
那么它们值是相等的且可用下面式子计算得出。
\begin{align}  
    c_i^* &= c^* = b - \theta_{-i} \tau \notag\\ 
    &= b - \tau  + \Bigl[ \prod_{j \in\{-i\} } [0 - P(c_j^*) ] \Bigr] \tau \notag\\ 
    &= b - \tau + \Bigl[ [1 - P(c^*)]^{N-1} \Bigr] \tau
\label{eqn:chap_bayesian:equilibrium_cost_equation}
\end{align}
%%%%%%%%%%%%%%
\section{数值分析与讨论}
我们对两种最常见的概率分布形式进行分析与讨论。
\subsection{均匀分布的情况}
均匀分布是连续概率分布函数中最常见和最简单。它在所有的概率分布中占着重要的地位。
许多实际上重要的随机变量者服从或是近似服从均匀分布。
此处，我们假设用户的类型的概率分布$P(\cdot)$是在区间$[C_{\min}=0, C_{\max}=1]$上的均匀分布。
它的概率密度函数为
\begin{align}
    f_(c) = \begin{cases} c, &\text{if $c \in [C_{\min}=0, C_{\max}=1]$;}\\
        0, &\text{others}\\ 
    \end{cases} 
    \label{eqn_equilibrium_prob} 
\end{align}
其中，我们假设对于用户的成本被认为是归一化的。
则达到成本均衡$c^*$来说，它的概率为
\begin{align} 
    P(c^*) &= \text{Prob} \Bigl\{ 0 < c_i < c^*\Bigr\} \notag\\ 
    &= \frac{c^*}{C_{\max}-C_{\min}} \notag\\
    &= c^* 
    \label{eqn_probability_of_contribution} 
\end{align}
我们把公式\ref{eqn_probability_of_contribution}代入公式\ref{eqn:chap_bayesian:equilibrium_cost_equation}则有
\begin{align*} 
    c^* &= b - \tau + (1-c^*)^{N-1}\tau
\end{align*}
当我们把均衡概率图画出来，就会发现一个些有意义的理论结果，
如图\ref{fig:bayesian_user_numb_vs_contr_prob}和图\ref{fig:bayesian_puni_para_vs_cont_prob}。
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
\begin{centering}
\includegraphics[scale=0.7]{../figures/bayesian_user_number_vs_contribute_probability.eps}
\caption{用户数目与贡献概率的关系}
\label{fig:bayesian_user_numb_vs_contr_prob}
\end{centering}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[!htb]
\begin{centering}
\includegraphics[scale=0.7]{../figures/bayesian_punish_parameter_vs_contribute_probability.eps}
\caption{惩罚系数与贡献概率之间的关系}
\label{fig:bayesian_puni_para_vs_cont_prob}
\end{centering}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
当用户数目增多时，贡献的概率会随之降低。
这意味着，当系统中用户较少时，用户容易做出接受资源调整的决策。
而当系统用户较多时，即使用户的收益比成本高，用户也可能会做也拒绝的决定。
并且，从图中还可以看到均衡成本在用户数目极大时，存在极限$b-\tau$。
另外，
当惩罚的系数的值增大时，并不会让用户决定贡献的机率增大。这一点与我们的直觉是不同的。
因此在系统中设置一个能够自适应网络状态的奖励参数和惩罚参数是十分必要的。
\subsection{正态分布的情况}
对于用户的成本类型，第二种我们假设的概率分布是正态分布。
也是一个在数学、物理及工程等领域都非常重要的概率分布。
对于用户成本随机变量$c$服从一个位置参数为$\mu$，尺度参数为$\sigma$的概率分布，
通常可以记为：
\begin{align*}
    c \sim N(\mu, \sigma^2)
    \label{eqn:normal_distribution}
\end{align*}
服从正态分布的随机变量的概率密度函数$f(x)$由公式\ref{eqn:chap_bayesian:normoal_density}和\ref{eqn:chap_bayesian:normoal_cdf}给出，
且其概率密度函数和概率分布函数如图\ref{fig:chap_bayesian:normal_density_scheme}和\ref{fig:chap_bayesian:normal_cdf_schem}所示。
其中，与均匀分布类似的，为了将成本随机变量控制在区间$[0,1]$，我们假设成本概率分布的均值为$\mu = 0.5$，方差$\delta = 0.1$。
\begin{align}
    f(x) = \frac{1}{\sigma \sqrt{2\pi} } e^{ \frac{-(c-\mu)^2}{2\sigma^2}}
    \label{eqn:chap_bayesian:normoal_density}
\end{align}
\begin{align}
    F(x) = \frac{1}{\sigma \sqrt{2\pi} } \int^x_{-\infty}e^{ \frac{-(c-\mu)^2}{2\sigma^2}}
    \label{eqn:chap_bayesian:normoal_cdf}
\end{align}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure} 
  \begin{minipage}[t]{0.5\linewidth} 
    \centering 
    \includegraphics[width = \textwidth]{bayesian_normal_density_scheme.eps} 
    \caption{正态分布的概率密度函数} 
    \label{fig:chap_bayesian:normal_density_scheme} 
  \end{minipage}% 
  \begin{minipage}[t]{0.5\linewidth} 
    \centering 
    \includegraphics[width=\textwidth]{bayesian_normal_cdf_scheme.eps} 
    \caption{正态分布的累积概率函数} 
    \label{fig:chap_bayesian:normal_cdf_schem} 
  \end{minipage} 
\end{figure}
类似的，如果将公式\ref{eqn:chap_bayesian:normoal_cdf}代入公式\ref{eqn:chap_bayesian:equilibrium_cost_equation}，
则有，
\begin{align*} 
    c^* &= b - \tau + \left[ 1-\frac{1}{\sigma \sqrt{2\pi} } \int^x_{-\infty}e^{ \frac{-(c-\mu)^2}{2\sigma^2}} \right] ^{N-1}\tau
\end{align*}
由于正态分布函数概率密度函数不能显式积分，所以我们只能通过数值求解的方式，将收益参数、惩罚参数、用户数目与均衡概率关系画出来。
如图所示。
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{仿真实验与结果}

\section{小结}
